import"./tailwind-hLRvZ190.js";import{a as h,g as a}from"./getNode-pa7syr6m.js";import{p as v}from"./delay-L14dHocY.js";import{c as W,a as G}from"./Modal-LwrVZ11o.js";const z=e=>{const t=h(".valid-input-box");function d(n){const o=+n.dataset.index,{min:c,max:u}=e[o],p=n.value.replace(/\s*/g,"").length,b=p>c&&p<=u;return e[o].isValid=b,b}function g(n,o){const c=n.closest(".input-wrapper");o?c.classList.remove("invalid"):c.classList.add("invalid")}function r(n){const{value:o}=n,c=+n.dataset.index,u=n.nextElementSibling.querySelector(".letter-count");u.textContent=`${o.length}/${e[c].max}`}function N({target:n}){const o=d(n);g(n,o),r(n)}const M={state:!1},j=[];return[t.forEach((n,o)=>{const{id:c,min:u=0,max:p=24,placeholder:b="",label:D}=e[o],F=`
      <label for="${c}" class="text-label-sm pb-2">${D}</label>
      <div class="input-wrapper group flex flex-col w-full">
        <input
          type="text"
          id=${c}
          data-index="${o}"
          placeholder="${b}"
          minlength="${u}"
          maxlength="${p}"
          class="group-[.invalid]:border-red-500 p-2 text-paragraph-sm w-full outline-none border border-contents-content-tertiary rounded"
          spellcheck="false"
        />
        <div class="flex justify-between">
          <span
            class="group-[&:not(.invalid)]:opacity-0 text-red-500 text-paragraph-sm opacity-1"
          >글자 수는 ${u+1}자 이상 ${p}자 이하로 작성해주세요.</span>
          <span
            aria-live="polite"
            class="group-[.invalid]:text-red-500 letter-count text-contents-content-tertiary text-paragraph-sm"
          >0/${p}</span>
        </div>
      </div>
      `;n.insertAdjacentHTML("beforeend",F);const B=a(`input#${c}`);B.addEventListener("input",N),j.push(B),Object.defineProperty(M,"state",{get(){return this._state},set(_){this._state=_,j.forEach(J=>r(J))}})}),M]};await v.collection("users").authRefresh();const C=localStorage.getItem("login"),K=localStorage.getItem("users-oauth"),l=JSON.parse(K),Q=localStorage.getItem("pocketbase_auth"),i=JSON.parse(Q),m=a("#saveButton"),X=h(".cancelButton"),Y=[{id:"nameInput",min:0,max:8,placeholder:"별명이나 이름을 입력해주세요.",label:"이름"},{id:"jobInput",min:0,max:20,placeholder:"어떤 일을 하는지 알려주세요.",label:"직업"},{id:"companyInput",min:0,max:24,placeholder:"일하시는 곳을 알려주세요.",label:"직장"}],[,Z]=z(Y),x=a("#aboutMeInput"),P=a("#characterCount");function U(){const e=x.value.length;P.textContent=`${e}/500`,e>500&&(x.value=x.value.substring(0,500),P.textContent="500/500")}x.addEventListener("input",U);const R=a("#private"),T=a("#male"),O=a("#female");function E(e){const t=document.querySelector("[checked]");t&&t.removeAttribute("checked"),e.target.setAttribute("checked","checked")}R.addEventListener("click",E);T.addEventListener("click",E);O.addEventListener("click",E);const s={input:[...h(".required-input")].every(e=>e.value.length>0),agree:!1},w=a("#all-agree-checkbox"),S=h(".agree-checkbox"),ee=()=>{const e=[...S].every(t=>t.checked);e?(s.agree=!0,m.disabled=!s.input||!s.agree):(m.disabled=!0,s.agree=!1),w.checked=e};w.addEventListener("change",()=>{const e=w.checked;S.forEach(t=>{t.checked=e}),m.disabled=!e,s.agree=e,m.disabled=!s.input||!s.agree});S.forEach(e=>{e.addEventListener("change",ee)});const te=h(".required input");te.forEach(e=>{e.classList.add("required-input")});const q=Array.from(h(".required-input"));q.forEach(e=>{e.addEventListener("input",()=>{const t=q.every(d=>d.value!=="");s.input=t,m.disabled=!s.input||!s.agree})});const[V,ae]=W({title:"🥳 저장 완료!",desc:"프로필 정보가 저장되었습니다.",buttonText:"확인"}),[H,ne,oe]=G({title:"😱 나가시겠어요?",desc:"변경사항이 저장되지 않아요. <br /> 정말로 나가시겠어요?",cancelText:"취소",submitText:"확인"}),$=a("#nameInput"),y=a("#jobInput"),L=a("#companyInput"),I=a("#aboutMeInput"),f=a("#file"),k=a("#image-wrapper"),ce=async()=>{const e=document.querySelector('input[name="gender"]:checked');if(C==="false"){const t=new Uint16Array(1),d=crypto.getRandomValues(t).join(""),g={username:`${l.email.split("@")[0]}`,email:`${l.email}`,emailVisibility:!0,password:`${l.password}`,passwordConfirm:`${l.passwordConfirm}`,categorys:l.categorys.map(r=>r.toLowerCase()),phone:`${l.phone}`,avatar:f.files[0],name:`${$.value}`,gender:`${e.id}`,job:`${y.value}`,company:`${L.value}`,introduce:`${I.value}`,period:Math.ceil(Math.random()*10),userCord:d,sellingProductCount:123};V.closing(),await v.collection("users").create(g),await v.collection("users").authWithPassword(l.email,l.password).then(()=>{window.location.href="/src/pages/main/"}),localStorage.removeItem("users-oauth"),localStorage.setItem("login","true")}else{const t={avatar:f.files[0],name:`${$.value}`,gender:`${e.id}`,job:`${y.value}`,company:`${L.value}`,introduce:`${I.value}`};t.avatar=f.files[0]||null,v.collection("users").update(i.model.id,t).then(()=>{window.location.href="/src/pages/myeuid/myProfile.html"})}};ae.onclick=ce;m.onclick=()=>V.showing();const se=window.localStorage,re=()=>{C==="true"?window.location.href="/src/pages/myeuid/myProfile.html":(se.clear(),window.location.href="/src/pages/login/")},ie=()=>H.closing();ne.onclick=ie;oe.onclick=re;X.forEach(e=>{e.onclick=()=>H.showing()});const A=a("#image-preview"),le=a("#file-clear");function de({target:e}){if(e.value==="")return;const{files:t}=e;k.innerHTML="",[...t].forEach(d=>{const g=URL.createObjectURL(d),r=document.createElement("img");r.classList.add("w-[50px]","h-[50px]"),r.id="userImg",r.src=g,k.appendChild(r)}),A.classList.remove("hidden")}f.addEventListener("change",de);function ue({target:e}){f.value="",k.innerHTML="",A.classList.add("hidden")}le.addEventListener("click",ue);const pe=await v.collection("users").getOne(i.model.id,{fields:"avatar"});function me(e,t="photo"){return`https://suppose-weather.pockethost.io//api/files/users/${i.model.id}/${e[t]}`}if(C==="true"){i.model.avatar!==""&&(A.classList.remove("hidden"),k.insertAdjacentHTML("afterbegin",`
    <img class="w-[50px] h-[50px]" id="userImg" src="${me(pe,"avatar")}">
    `)),$.value=i.model.name,y.value=i.model.job,L.value=i.model.company,I.value=i.model.introduce,U(),Z.state=!0;const e=i.model.gender,t=a(`#${e}`);t?t.setAttribute("checked","checked"):(R.removeAttribute("checked"),T.removeAttribute("checked"),O.removeAttribute("checked"))}
